<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Welcome!{% endblock %}</title>

    {# Bootstrap depuis CDN #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <script src="https://js.stripe.com/v3/"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const myCarousel = document.querySelector('#carouselExampleInterval');
            if (myCarousel) {
                new bootstrap.Carousel(myCarousel, {
                    interval: 3000,
                    ride: 'carousel'
                });
            }
        });
    </script>

    <link rel="icon" href="data:image/svg+xml,
        <svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22>
            <text y=%221.2em%22 font-size=%2296%22>‚ö´Ô∏è</text>
            <text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text>
        </svg>">

    {% block stylesheets %}{% endblock %}
    {% block javascripts %}
        {% block importmap %}{{ importmap('app') }}{% endblock %}
    {% endblock %}
</head>
<body>
<div class="page-wrapper d-flex flex-column min-vh-100">
    {% block nav %}
        {% include 'layouts/nav.html.twig' %}
    {% endblock %}

    <main class="flex-grow-1">
        {% block body %}{% endblock %}
    </main>

    {% block footer %}
        <footer class="bg-dark text-light text-center py-3">
            <div class="footer-container">
                <p>&copy; 2025 NB-ONE. Tous droits r√©serv√©s.</p>
                <ul class="footer-links list-inline">
                    <li class="list-inline-item">
                        <a href="{{ path('mentions_legales') }}" class="text-light">Mentions l√©gales</a>
                    </li>
                    <li class="list-inline-item">
                        <a href="{{ path('confidentialite') }}" class="text-light">Confidentialit√©</a>
                    </li>
                    <li class="list-inline-item">
                        <a href="{{ path('contact') }}" class="text-light">Contact</a>
                    </li>
                </ul>
            </div>
        </footer>
    {% endblock %}
</div>

{# üí¨ Chatbot widget am√©lior√© #}
<div id="chatbot-bubble">üí¨</div>

<div id="chatbot-window" class="chatbot-window">
    <div id="chatbot-header">
        <span>ü§ñ Assistant NB-ONE</span>
        <button id="chatbot-close">√ó</button>
    </div>
    <div id="chat-messages"></div>
    <div class="chat-input-container">
        <input type="text" id="chat-input" placeholder="√âcrivez un message..."/>
        <button id="chat-send">‚û§</button>
    </div>
</div>

<style>
    /* Bulle flottante */
    #chatbot-bubble {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background:orange;
        color: white;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        z-index: 9999;
        transition: transform 0.2s ease;
    }
    #chatbot-bubble:hover {
        transform: scale(1.1);
    }

    /* Fen√™tre principale */
    .chatbot-window {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 320px;
        height: 450px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.25);
        display: none;
        flex-direction: column;
        overflow: hidden;
        z-index: 9999;
        animation: fadeInUp 0.3s ease;
    }

    @keyframes fadeInUp {
        from {opacity: 0; transform: translateY(30px);}
        to {opacity: 1; transform: translateY(0);}
    }

    /* En-t√™te */
    #chatbot-header {
        background: #28a745;
        color: white;
        padding: 12px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    #chatbot-header button {
        background: transparent;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
    }

    /* Messages */
    #chat-messages {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        font-size: 14px;
        background: #f9f9f9;
        display: flex;
        flex-direction: column;
    }

    .bot-message {
        align-self: flex-start;
        background: #e5e5e5;
        padding: 8px 12px;
        margin: 5px 0;
        border-radius: 12px 12px 12px 0;
        max-width: 80%;
    }
    .user-message {
        align-self: flex-end;
        background: #28a745;
        color: white;
        padding: 8px 12px;
        margin: 5px 0;
        border-radius: 12px 12px 0 12px;
        max-width: 80%;
    }

    /* Input */
    .chat-input-container {
        display: flex;
        border-top: 1px solid #ddd;
    }
    #chat-input {
        flex: 1;
        border: none;
        padding: 10px;
        outline: none;
    }
    #chat-send {
        background: #28a745;
        color: white;
        border: none;
        padding: 0 15px;
        cursor: pointer;
        font-size: 18px;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const bubble = document.getElementById("chatbot-bubble");
        const windowBox = document.getElementById("chatbot-window");
        const closeBtn = document.getElementById("chatbot-close");
        const input = document.getElementById("chat-input");
        const sendBtn = document.getElementById("chat-send");
        const messages = document.getElementById("chat-messages");

        function addMessage(sender, text) {
            const div = document.createElement("div");
            div.classList.add(sender === "Vous" ? "user-message" : "bot-message");
            div.textContent = text;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        async function sendMessage() {
            const text = input.value.trim();
            if (!text) return;

            addMessage("Vous", text);
            input.value = "";

            const response = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: text })
            });

            const data = await response.json();
            if (data.reply) {
                addMessage("Bot", data.reply);
            } else {
                addMessage("Bot", "‚ö†Ô∏è Erreur lors de la r√©ponse.");
            }
        }

        sendBtn.addEventListener("click", sendMessage);
        input.addEventListener("keypress", e => {
            if (e.key === "Enter") sendMessage();
        });

        bubble.addEventListener("click", () => {
            windowBox.style.display = "flex";
            bubble.style.display = "none";
        });

        closeBtn.addEventListener("click", () => {
            windowBox.style.display = "none";
            bubble.style.display = "flex";
        });
    });
</script>
</body>
</html>
